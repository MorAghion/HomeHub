{
  "id": "fe-bug-018",
  "title": "Context-based suggestions don't trigger on Hebrew list names",
  "agent": "frontend",
  "phase": "0.4",
  "priority": "high",
  "status": "todo",
  "created": "2026-02-24",
  "updated": "2026-02-24",
  "reported_by": "human — manual testing in Hebrew mode",

  "user_reported": "The MasterList context-based suggestions work partially in Hebrew — need to extend the context.",

  "root_cause_analysis": {
    "summary": "The Hebrew context matcher uses simple substring matching (`name.includes(keyword)`) without trimming or lowercasing the input. The English matcher uses `\\b keyword \\b` word-boundary regex with the `i` flag. More importantly, the Hebrew keyword lists in `CONTEXT_RECOGNITION_MAPPING_HE` are incomplete — many common Hebrew list name patterns are missing, so suggestions don't appear at all for those names.",

    "how_matching_works": {
      "file": "src/utils/contextResolver.ts",
      "flow": [
        "getSuggestedContexts(subHubName) is called with the list name",
        "It calls both getSuggestedContextsEn() and getSuggestedContextsHe() and merges results",
        "When Hebrew is active, Hebrew display labels are preferred for matched contexts",
        "If Hebrew matching fails but English matching succeeds, the bubble still shows (in English label)",
        "If both fail, no suggestion bubble appears at all"
      ]
    },

    "hebrew_matcher_issues": {
      "file": "src/utils/he/contextMapping.ts",
      "line": "417-422",
      "code": "if (name.includes(keyword)) { suggestedContexts.add(contextKey); break; }",
      "problems": [
        "No toLowerCase() or trim() on the input name before matching",
        "Missing common Hebrew list name patterns — e.g., a user naming a list 'קניות שבת' (Shabbat shopping) would need 'קניות' in the grocery keywords — it IS there, so that works. But less common patterns fail.",
        "No fallback: if Hebrew match fails and English match also fails (because the name is Hebrew), no suggestions appear at all"
      ]
    },

    "missing_hebrew_keyword_gaps": {
      "grocery_context": {
        "current_keywords": ["סופרמרקט", "מכולת", "קניות", "אוכל", "שוק", "מזון", "קניון", "רמי לוי", "שופרסל", "מגה", "ויקטורי", "קאנטרי", "יינות ביתן", "קניות שבועיות", "מזון טרי"],
        "missing_common_patterns": ["מצרכים", "ירקות ופירות", "השוק", "חנות", "ספר"]
      },
      "pharmacy_context": {
        "check_if_missing": "Keywords like 'בית מרקחת' should match 'תרופות' and 'היגיינה' named lists"
      },
      "camping_context": {
        "check_if_missing": "Keywords for camping trip list names in Hebrew"
      },
      "other_contexts": "Audit all contexts in CONTEXT_RECOGNITION_MAPPING_HE for completeness vs typical Hebrew naming patterns"
    }
  },

  "affected_files": [
    "src/utils/he/contextMapping.ts",
    "src/utils/contextResolver.ts"
  ],

  "implementation_plan": [
    "1. Read src/utils/he/contextMapping.ts in full — list all context keys and their current Hebrew keywords",
    "2. Read src/utils/contextMapping.ts (English) — compare keyword coverage per context",
    "3. For each context, add missing Hebrew keyword variations that users would realistically type as list names",
    "4. Fix the matcher in getSuggestedContextsHe() to trim and lowercase the input before matching (lines 412-422 in he/contextMapping.ts)",
    "5. Optionally: normalize Hebrew input — strip niqqud/punctuation if present",
    "6. Test: create lists with names like 'קניות שבת', 'מצרכים', 'תרופות', 'קמפינג', 'ניקיון', 'בייבי', 'מסיבת יום הולדת', 'גינה', 'חיות מחמד' — all should show suggestions",
    "7. Run npm run build — zero errors"
  ],

  "specific_fix_for_matcher": {
    "file": "src/utils/he/contextMapping.ts",
    "current_code": "const name = subHubName.trim();",
    "fix": "const name = subHubName.trim().toLowerCase(); // Hebrew has no case but this is defensive",
    "matching_line": "if (name.includes(keyword)) {",
    "note": "Hebrew does not have uppercase/lowercase, so toLowerCase() is harmless and defensive. The real fix is keyword coverage."
  },

  "keyword_additions_to_verify": {
    "grocery": ["מצרכים", "השוק", "חנות המכולת", "ירקות", "פירות"],
    "pharmacy": ["תרופות", "בית מרקחת", "היגיינה", "בריאות", "וויטמינים"],
    "baby": ["תינוק", "תינוקות", "ילד", "ילדים", "גן ילדים", "בייבי"],
    "camping": ["קמפינג", "טיול", "טבע", "אוהל", "שטח", "נאות"],
    "cleaning": ["ניקיון", "נקיון", "ניקוי", "לנקות", "ניקוי הבית"],
    "pets": ["חיות מחמד", "כלב", "חתול", "חיות", "ציוד לחיות"],
    "party": ["מסיבה", "מסיבת יום הולדת", "יום הולדת", "אירוע", "חגיגה", "קוקטייל"],
    "gardening": ["גינה", "גינון", "צמחים", "גן", "עציצים", "שתילים"],
    "home_renovation": ["שיפוץ", "בנייה", "תיקון", "אינסטלציה", "חשמל", "צבע"]
  },

  "notes": [
    "The context system already works partially — English list names always show suggestions. The gap is Hebrew-named lists.",
    "getSuggestedContexts() merges English + Hebrew results, so if a Hebrew-named list accidentally contains an English word it might still match. The goal is to ensure ALL common Hebrew naming patterns trigger the right suggestion.",
    "Do NOT change the English contextMapping.ts — it is stable and working.",
    "listCategory values on items remain English (internal keys) — do not change those.",
    "After fixing, verify that the 'Quick Add from Templates' bubbles in MasterListDrawer appear correctly when the list name is in Hebrew."
  ]
}
